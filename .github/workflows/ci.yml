name: CI for E2E tests

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      -main

jobs:
  build-and-test:
    runs-on: ubuntu-lastest

    steps:

      #1. descarga del codigo fuente
      - name: Checkout code
      uses:actions/checkout@v3

      #2 configurar JDK
      - name Setup JDK 
      uses:actions/setup-java@v3
      with:
        distribution: "temurin"
        java-version: 17
      
      # 3 Cache y dependencias

      - name Cache Gradle dependencias
        uses:actions/cache@v3
        with:
          path:~/.gradle/caches
        key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

        
      # 4 permisos generales

      - name: permisos
        run: chmod +x ./gradlew

        #5 verificar versiones de trabajo
      - name verifica gradle wrapper
        run: ./gradlew wrapper --gradle-version 8.13

        #6 ejectar
      - name: Run tests
        run: ./gradlew test --tests "org.nttdata.runner.EjecutarLogin" --info